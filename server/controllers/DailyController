import { Collection, Db, ObjectId } from "mongodb"
import { MongoClient, ServerApiVersion } from 'mongodb'

const DailyController = (collection) => ({
    //Get all items in the Daily List
    async getAllItems(req, res, next) {
        try {
            const items = await collection.find({}).toArray();
            res.locals.items = items;
            return next();
        } catch (err) {
            return next('Error in DailyController.getAllItems: ' + JSON.stringify(err));
        }
    },

    async addItem(req, res, next) {
        try {
            const { name, calories } = req.body;
            const result = await collection.insertOne({ name, calories });
            res.locals.newItem = {_id: result.insertedId, name, calories};
            return next();
        } catch (err) {
            return next('Error in DailyController.addItem: ' + JSON.stringify(err))
        }
    },

    async deleteItem(req, res, next) {
        try {
            const id = req.params.id;
            await collection.deleteOne({_id: new ObjectId(id)});
            res.locals.deletedItem = 'Succesfully deleted item!';
            return next();
        } catch (err) {
            return next('Error in DailyController.deleteItem: ' + JSON.stringify(err))
        }
    }
});

export default DailyController